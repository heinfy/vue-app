{"version":3,"sources":["webpack:///./src/components/PdfPreview.vue?8001","webpack:///./src/views/003pdfPreview/index.vue?b4b9","webpack:///./src/views/003pdfPreview/index.vue?73d2","webpack:///./src/components/PdfPreview.vue?71e7","webpack:///src/components/PdfPreview.vue","webpack:///./src/components/PdfPreview.vue?bf55","webpack:///./src/components/PdfPreview.vue","webpack:///src/views/003pdfPreview/index.vue","webpack:///./src/views/003pdfPreview/index.vue?916a","webpack:///./src/views/003pdfPreview/index.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","url","staticRenderFns","_v","_s","showPageNum","docPages","_l","page","index","key","ref","refInFor","style","height","pageHeight","renderList","includes","_e","props","type","String","required","renderPages","Number","default","customScroll","Boolean","offsetHeight","data","doc","currentPage","timer","watch","immediate","handler","getPDFFile","created","document","addEventListener","scroll","beforeDestroy","removeEventListener","methods","cMapUrl","cMapPacked","httpHeaders","verbosity","scrollToPage","pageNo","list","push","filter","$nextTick","renderPage","getPage","then","canvas","width","ratio","ctx","setTransform","canvasContext","viewport","getViewport","__rendered","scrollTop","Math","floor","scrollHeight","checkRender","documentElement","el","window","pageYOffset","body","max","min","component","name","components","pdfPreview"],"mappings":"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","file":"static/js/chunk-d8acfef8.9f5cf88b.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PdfPreview.vue?vue&type=style&index=0&id=1dce6e5e&lang=less&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PdfPreview.vue?vue&type=style&index=0&id=1dce6e5e&lang=less&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=29383a56&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=29383a56&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"main-container\"},[_c('header-component',{attrs:{\"title\":'pdf文件预览'}}),_c('pdf-preview',{attrs:{\"url\":_vm.url}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"pdf-preview-container\"},[_c('span',{staticClass:\"page_num\"},[_vm._v(_vm._s(_vm.showPageNum)+\"/\"+_vm._s(_vm.docPages))]),_vm._l((_vm.docPages),function(page,index){return _c('div',{key:page,ref:\"container\",refInFor:true,staticClass:\"page-container\",style:({\n      height: (_vm.pageHeight + \"px\")\n    }),attrs:{\"data-index\":index}},[(_vm.renderList.includes(page))?_c('canvas'):_vm._e()])})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"pdf-preview-container\">\n    <span class=\"page_num\">{{showPageNum}}/{{docPages}}</span>\n    <div\n      class=\"page-container\"\n      ref=\"container\"\n      v-for=\"(page, index) in docPages\"\n      :style=\"{\n        height: `${pageHeight}px`\n      }\"\n      :key=\"page\" :data-index=\"index\">\n      <canvas v-if=\"renderList.includes(page)\">\n      </canvas>\n    </div>\n  </div>\n</template>\n\n<script>\nimport pdfJS from 'pdfjs-dist/webpack'\n\nexport default {\n  props: {\n    url: {\n      type: String,\n      required: true\n    },\n    renderPages: {\n      type: Number,\n      default: 5\n    },\n    customScroll: {\n      type: Boolean,\n      default: false\n    },\n    offsetHeight: {\n      type: Number,\n      default: 0\n    }\n  },\n  data() {\n    return {\n      doc: null,\n      docPages: 0,\n      showPageNum: 0,\n      currentPage: 0,\n      pageHeight: 0,\n      renderList: [],\n      timer: 0\n    }\n  },\n  watch: {\n    url: {\n      immediate: true,\n      handler() {\n        this.getPDFFile()\n      }\n    }\n  },\n  created() {\n    if(!this.customScroll) {\n      document.addEventListener('scroll', this.scroll)\n    }\n  },\n  beforeDestroy() {\n    document.removeEventListener('scroll', this.scroll)\n  },\n  methods: {\n    getPDFFile() {\n      if(!this.url) return\n      this.currentPage = 0\n      // getDocument 加载要打开的PDF文件\n      pdfJS.getDocument({\n        url: this.url,\n        cMapUrl: 'https://unpkg.com/pdfjs-dist@2.3.200/cmaps/', // 这里同样要引入字体解决水印问题，需自己提供\n        cMapPacked: true,\n        httpHeaders: {\n            // headers\n        },\n        verbosity: 0\n      }).promise.then(pdf => {\n        this.doc = pdf\n        this.docPages = pdf.numPages\n        this.showPageNum = 1\n        this.$nextTick(() => {\n          // 渲染第一屏\n          this.docPages && this.scrollToPage(1)\n        })\n      })\n    },\n    scrollToPage(pageNo) {\n      if(this.currentPage === pageNo) return\n      // 赋值给当前页\n      this.currentPage = pageNo\n      const list = []\n      for(let page = pageNo; page <= pageNo + this.renderPages; page++) {\n        list.push(page)\n      }\n      this.renderList = list.filter(page => page <= this.docPages)\n      this.$nextTick(() => {\n        this.renderList.forEach(page => {\n          this.renderPage(page)\n        })\n      })\n    },\n    // 渲染page\n    renderPage(pageNo) {\n      this.doc.getPage(pageNo).then(page => {\n        const container = this.$refs.container[pageNo - 1]\n        if(!container) return\n        const canvas = container.querySelector('canvas')\n        if(!canvas || canvas.__rendered) return\n        const ctx = canvas.getContext('2d')\n        const dpr = window.devicePixelRatio || 1\n        const bsr = ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || ctx.backingStorePixelRatio || 1\n        const ratio = dpr / bsr\n        const rect = container.getBoundingClientRect()\n        const viewport = page.getViewport({ scale: 1.0 })\n        const width = rect.width\n        const height = width / viewport.width * viewport.height\n        canvas.style.width = `${width}px`\n        canvas.style.height = `${height}px`\n        this.pageHeight = height\n        canvas.height = height * ratio\n        canvas.width = width * ratio\n        ctx.setTransform(ratio, 0, 0, ratio, 0, 0)\n        page.render({\n          canvasContext: ctx,\n          viewport: page.getViewport({ scale: width / viewport.width })\n        })\n        canvas.__rendered = true\n      })\n    },\n    // 计算当前页数\n    scroll() {\n      const scrollHeight = document.body.scrollHeight // 页面高度\n      const screenHeight = window.screen.height // 屏幕高度\n      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop\n      if(scrollTop + screenHeight < scrollHeight) {\n        this.showPageNum = scrollTop <= 0 ? 1 : this.docPages - Math.floor((scrollHeight - scrollTop) / this.pageHeight)\n      } else {\n        this.showPageNum = this.docPages\n      }\n      this.checkRender(document.documentElement)\n    },\n    checkRender(el) {\n      if(!this.pageHeight) return\n      let scrollTop = el.scrollTop\n      if(el === document.documentElement) {\n        scrollTop = el.scrollTop || window.pageYOffset || document.body.scrollTop\n      }\n      let page = Math.floor((scrollTop - this.offsetHeight) / this.pageHeight)\n      page = Math.max(page, 1)\n      page = Math.min(page, this.docPages)\n      this.scrollToPage(page)\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.page_num {\n  position: fixed;\n  left: 20px;\n  top: 60px;\n  z-index: 99;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PdfPreview.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PdfPreview.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PdfPreview.vue?vue&type=template&id=1dce6e5e&scoped=true&\"\nimport script from \"./PdfPreview.vue?vue&type=script&lang=js&\"\nexport * from \"./PdfPreview.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PdfPreview.vue?vue&type=style&index=0&id=1dce6e5e&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1dce6e5e\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"main-container\">\n    <header-component :title=\"'pdf文件预览'\"></header-component>\n    <pdf-preview :url=\"url\"></pdf-preview>\n  </div>\n</template>\n\n<script>\nimport pdfPreview from '@/components/PdfPreview.vue'\n\nexport default {\n  name: 'pdfpreview',\n  components: {\n    pdfPreview\n  },\n  data() {\n    return {\n      url: 'https://zm-cms-image.oss-cn-hangzhou.aliyuncs.com/defe19f8-7402-44ed-bd44-1479d612a837.pdf'\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.main-container {\n  margin-top: 44px;\n  .content {\n    button {\n      display: block;\n      background-color: #f5f5f5;\n      min-width: 200px;\n      height: 44px;\n      line-height: 44px;\n      margin: 20px auto 0;\n      border: 1px solid #a5c5b5;\n      border-radius: 2px;\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=29383a56&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=29383a56&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"29383a56\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}